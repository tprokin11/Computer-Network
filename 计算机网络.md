# 计算机网络

## Chapter 1

### 1.8 历史

定义超文本及协议

![image-20250319104721101](/Users/jet/Library/Application Support/typora-user-images/image-20250319104721101.png)

http协议访问

html网页之间可以互相指向

1994年网景公司

![image-20250319105133737](/Users/jet/Library/Application Support/typora-user-images/image-20250319105133737.png)

即时通信 p2p网络共享

促使ISP不断扩容 市场利润来维持企业发展

![image-20250319105424981](/Users/jet/Library/Application Support/typora-user-images/image-20250319105424981.png)

带宽越来越高 资费越来越便宜 

互联网内容提供商ICP

### 1.9 小结

![image-20250319105638262](/Users/jet/Library/Application Support/typora-user-images/image-20250319105638262.png)

![image-20250319105841278](/Users/jet/Library/Application Support/typora-user-images/image-20250319105841278.png)

![image-20250319105848835](/Users/jet/Library/Application Support/typora-user-images/image-20250319105848835.png)

![image-20250319105901526](/Users/jet/Library/Application Support/typora-user-images/image-20250319105901526.png)

![image-20250319105927251](/Users/jet/Library/Application Support/typora-user-images/image-20250319105927251.png)

光纤可以构成树也可以构成图

![image-20250319110034782](/Users/jet/Library/Application Support/typora-user-images/image-20250319110034782.png)



## Chapter 2 应用层

### 2.1 应用层协议原理 

![image-20250319143014913](/Users/jet/Library/Application Support/typora-user-images/image-20250319143014913.png)

FTP本身也是一种应用 原理-实例-编程部分

![image-20250319143115147](/Users/jet/Library/Application Support/typora-user-images/image-20250319143115147.png)

应用需要在传输层提供的服务上才能交换报文

交互模式 ： C/S模式 P2P模式

SOCKET API 原语 套接字编程 提供的接口

传输层向应用层提供的接口来实现网络编程

![image-20250319143424144](/Users/jet/Library/Application Support/typora-user-images/image-20250319143424144.png)

应用层的协议最多 

![image-20250319143732033](/Users/jet/Library/Application Support/typora-user-images/image-20250319143732033.png)

WEB应用 开发-租服务器 

服务器上运行服务器软件 

![image-20250319143901903](/Users/jet/Library/Application Support/typora-user-images/image-20250319143901903.png)

![image-20250319143915554](/Users/jet/Library/Application Support/typora-user-images/image-20250319143915554.png)

服务器先运行，且一直在运行，运行在一些固定且知名的端口

服务器的地址一般不动，客户端的IP可以动，一般是动态IP

服务器在中心，资源在服务器 

可扩展性比较差 ： 随着访问的用户增加，断崖式的下降

![image-20250319144216917](/Users/jet/Library/Application Support/typora-user-images/image-20250319144216917.png)

![image-20250319144244606](/Users/jet/Library/Application Support/typora-user-images/image-20250319144244606.png)

可靠性也较差

由此诞生了P2P

![image-20250319144306664](/Users/jet/Library/Application Support/typora-user-images/image-20250319144306664.png)

每个节点既可以提供服务又可以请求服务

当节点增加时，请求服务和提供服务的节点都能增加 ，所以是平滑下降/增加

缺点：管理较为困难 

![image-20250319144440025](/Users/jet/Library/Application Support/typora-user-images/image-20250319144440025.png)

Napster 上线时需要告诉服务器 请求文件下载 

文件分发是P2P形式   目录查询是C/S形式的（集中式）

采用P2P的方式分享音乐 用户越多，资源越多，下载速度越快 

百度、迅雷都采用P2P的方式来上行下载

![image-20250319144943232](/Users/jet/Library/Application Support/typora-user-images/image-20250319144943232.png)

两个应用连接通信 - 不同端系统上两个应用的通信

Peer-对等体 

![image-20250319145233437](/Users/jet/Library/Application Support/typora-user-images/image-20250319145233437.png)

Q1:应用进程需要标识自己 具有寻址功能 （标识、寻址） 

Q2：发送必须借助于层间接口 上下层的服务交互 

层间接口的API 找到下层，并借助下一层的服务 

接口 服务 形式 付费 （形式，地点的问题） 

如何定义应用报文的格式和解释 如何交互、如何实现协议行为 

Q3：服务、协议 如何实现网络交换的各种应用 

![image-20250319150229125](/Users/jet/Library/Application Support/typora-user-images/image-20250319150229125.png)

A1:

1. 在哪个终端设备上，IP是什么？
2. 在TCP还是UDP上面使用？
3. 在哪个端口上？由此引入了新的机制：端口号 
4. 主机IP TCP/UDP 端口号 

END POINT ： 应用端节点 

![image-20250319150247249](/Users/jet/Library/Application Support/typora-user-images/image-20250319150247249.png)

A2:

发的什么，谁发的，发的什么信息

段头+数据部分来完成封装 

应用使用传输提供的服务 

进程标识  

![image-20250320092352991](/Users/jet/Library/Application Support/typora-user-images/image-20250320092352991.png)

key point：应用层如何使用服务 

如何定义时序 -> port 

IP提供的标识就是网络地址 IP地址 

主机IP 应用进程使用的端口号 

减少层间传输的信息量 -> socket 

![image-20250320092901026](/Users/jet/Library/Application Support/typora-user-images/image-20250320092901026.png)

操作系统 API 描述符 

建立socket后 操作系统回返回一个整数 

端口号 本地操作系统管理的一个地址值

应用进程使用Socket来发 

Socket代表的是我和对方的端口的本地表示 

优点：

- 便于管理
- 减少传输信息

![image-20250320093303244](/Users/jet/Library/Application Support/typora-user-images/image-20250320093303244.png)

![image-20250320093436347](/Users/jet/Library/Application Support/typora-user-images/image-20250320093436347.png)

IP，端口，状态 - Socket表 

对方的IP由下方传过来 

![image-20250320093758682](/Users/jet/Library/Application Support/typora-user-images/image-20250320093758682.png)

TCP socket还标识会话关系

![image-20250320094129369](/Users/jet/Library/Application Support/typora-user-images/image-20250320094129369.png)

货物本身 端口号 对方IP 对方端口 

![image-20250320094428590](/Users/jet/Library/Application Support/typora-user-images/image-20250320094428590.png)

TCP相当于一个登记号 

UDP socket代表本地IP和本地端口

应用层可以借助传输层提供的服务来实现端口...

![image-20250320094757376](/Users/jet/Library/Application Support/typora-user-images/image-20250320094757376.png)

![image-20250320094832915](/Users/jet/Library/Application Support/typora-user-images/image-20250320094832915.png)

协议：对等层实体在通信当中应该遵守的规则集合

![image-20250320094935583](/Users/jet/Library/Application Support/typora-user-images/image-20250320094935583.png)

应用除了实体之外还有

实体只是和交换有关的那一部分 

open开放 ， 以RFC形式发布 

邮件对可靠性要求较高  延迟会影响交流 

吞吐：单位时间内有效的发出和接受数据量 

![image-20250320095555919](/Users/jet/Library/Application Support/typora-user-images/image-20250320095555919.png)

![image-20250320095631005](/Users/jet/Library/Application Support/typora-user-images/image-20250320095631005.png)

插值法解决数据丢失-噪点问题

TCP可靠传输  - 面向连接 

网络堵的时候可以降速 

![image-20250320100046942](/Users/jet/Library/Application Support/typora-user-images/image-20250320100046942.png)

![image-20250320100056547](/Users/jet/Library/Application Support/typora-user-images/image-20250320100056547.png)

**IP不能提供进程到进程的区分 ， UDP 可以提供进程到进程的通信**

重传需要耽误时间  对可靠性要求不高的应用适合跑在UDP上 

![image-20250320100345912](/Users/jet/Library/Application Support/typora-user-images/image-20250320100345912.png)

TCP为了可靠性会有延迟的影响

![image-20250320100438241](/Users/jet/Library/Application Support/typora-user-images/image-20250320100438241.png)



SSL也可以提供安全服务 SSL在应用层 

### 2.2 Web and Http 

![image-20250321084804687](/Users/jet/Library/Application Support/typora-user-images/image-20250321084804687.png)

Web网页本来就是一个对象 URL来访问

任何对象都可以采用URL的方式来标识 HTTP默认的是80号端口 

对象当中的链接也可以指向其他的链接 

框架 链接 。。。 WEB对象中还包含着其他链接 

对象指向对象 - 构成了一个类似于网状的结构 

WORLD WIDE WEB 在以前终端号采用拨号的方式上网 

![image-20250321085619310](/Users/jet/Library/Application Support/typora-user-images/image-20250321085619310.png)

文本-文本之间的指向关系 

不同服务器都遵守相同的协议。

![image-20250321085638813](/Users/jet/Library/Application Support/typora-user-images/image-20250321085638813.png)

HTTP跑在TCP之上  

- Waiting Socket
- 保持Socket
- 连接Socket

发送请求 回应请求  HTML画出来并进行解释 

HTTP最开始时是无状态的 服务器不需要维护客户端状态  所以支持的服务器更多 

![image-20250321090336515](/Users/jet/Library/Application Support/typora-user-images/image-20250321090336515.png)

WEB浏览器和WEB服务器建立连接时需要下面的层次提供服务

![image-20250321090510683](/Users/jet/Library/Application Support/typora-user-images/image-20250321090510683.png)

![image-20250321090634222](/Users/jet/Library/Application Support/typora-user-images/image-20250321090634222.png)

持续链接就是不关连接 - 可以一直发送接受信息来服务请求 

![image-20250321090659072](/Users/jet/Library/Application Support/typora-user-images/image-20250321090659072.png)

![image-20250321090915677](/Users/jet/Library/Application Support/typora-user-images/image-20250321090915677.png)

借助函数来建立连接 

请求 - 服务器响应 URL中主机的名字和连接 

请求连接 请求确认 请求对象 对象回来 关闭连接

![image-20250321091008570](/Users/jet/Library/Application Support/typora-user-images/image-20250321091008570.png)

小分组的传输时间可以忽略不计  一次传输至少包含两个RTT（Round Trip Time）

![image-20250321091257944](/Users/jet/Library/Application Support/typora-user-images/image-20250321091257944.png)

非流水线-一次请求对象只能返回一个

流水线-持续发送，连续接受  （一次性发完，减少传输时间）

![image-20250321091601558](/Users/jet/Library/Application Support/typora-user-images/image-20250321091601558.png)

所有报文都是ASCII码，可读可打印 

Get请求 Post上载

![image-20250321091916217](/Users/jet/Library/Application Support/typora-user-images/image-20250321091916217.png)

使用回车符间隔

Host之后是域名 

![image-20250321142303150](/Users/jet/Library/Application Support/typora-user-images/image-20250321142303150.png)

Post 和 Get都可以给服务器提交内容

HTML包括head和body 

源信息 用户检索 

![image-20250321142612326](/Users/jet/Library/Application Support/typora-user-images/image-20250321142612326.png)

Put 提交对象-维护网页 

![image-20250321142635607](/Users/jet/Library/Application Support/typora-user-images/image-20250321142635607.png)

- 协议 版本号 404-找不到网页  Server-服务器  
- Content-length 文本内容-多少个字节是http的内容 
- http运行在Tcp之上 Tcp提供的是字节流的服务 
- 所有Tcp都是自己来维护界限
- 状态码使用ascii码来表示 

![image-20250321143114289](/Users/jet/Library/Application Support/typora-user-images/image-20250321143114289.png)

![image-20250321143146369](/Users/jet/Library/Application Support/typora-user-images/image-20250321143146369.png)

![image-20250321143237515](/Users/jet/Library/Application Support/typora-user-images/image-20250321143237515.png)

http-无状态协议-不维护服务器的状态 

优点：

简单，服务器更加轻载 

C请求，S返回一个Cookies

客户端回应的文件  Cookies一直存在服务器的库中，所以可以一直关联客户端的访问行为

![image-20250321143743804](/Users/jet/Library/Application Support/typora-user-images/image-20250321143743804.png)

![image-20250321143835057](/Users/jet/Library/Application Support/typora-user-images/image-20250321143835057.png)

不需要再次登陆   Cookies会造成隐私问题 

![image-20250321144122007](/Users/jet/Library/Application Support/typora-user-images/image-20250321144122007.png)

Web代理 ：代理服务器 

- 服务器没有对象，向original server请求
- 服务器中存在对象，直接从本地服务器系统中读取即可

![image-20250321144415392](/Users/jet/Library/Application Support/typora-user-images/image-20250321144415392.png)

- 减轻服务器的响应负载
-  二八分布-安排一个小缓存就可以满足许多用户的请求

![image-20250321144713788](/Users/jet/Library/Application Support/typora-user-images/image-20250321144713788.png)

局域网内部带宽- 1Gbps 

带宽1.544mbps 速率1.5mbps 这两个十分接近，排队延迟将会非常大

流量强度越接近于1，排队延迟无限大

![image-20250321145138765](/Users/jet/Library/Application Support/typora-user-images/image-20250321145138765.png)

排队延迟计算如上

![image-20250321145156794](/Users/jet/Library/Application Support/typora-user-images/image-20250321145156794.png)

Situation 2:

扩大带宽100倍至154mbps  

![image-20250321150135160](/Users/jet/Library/Application Support/typora-user-images/image-20250321150135160.png)

Situation3:

在局域网内部安排一个缓存节点

大部分都能在本地访问命中，少部分再去远程访问

- 本地访问0.4 t1延迟
- 远程访问0.6 t2延迟

  ![image-20250321150637138](/Users/jet/Library/Application Support/typora-user-images/image-20250321150637138.png)

4成本地搞定，6成外地获取 

![image-20250321151013453](/Users/jet/Library/Application Support/typora-user-images/image-20250321151013453.png)

![image-20250321151135024](/Users/jet/Library/Application Support/typora-user-images/image-20250321151135024.png)

- 改变-更新对象 
- 未改变-直接交付对象即可 

改了就直接交付，没改的话告诉服务器就行了 

If-modified-since 是否改变 

条件Get - 解决服务器版本是否一致的问题



### 2.3 FTP 

FTP文件传输协议 

![image-20250322084640335](/Users/jet/Library/Application Support/typora-user-images/image-20250322084640335.png)

FTP服务器 

客户端 用户接口 本地文件系统 

本地也有本地的硬盘 

- 通过客户端upload上载到服务器 
- 也可以把服务器的文件下载到本地

在21号端口等待用户与其建立连接 

请求-连接建立-

list upload download 

![image-20250322084946828](/Users/jet/Library/Application Support/typora-user-images/image-20250322084946828.png)

两个应用进入Socket Api之后就可以成功建立连接 

身份认证：

- 用户名
- 口令

服务器主动与客户端的20号端口建立连接 - 数据连接 

带外传控制命令，带内传数据 

控制命令的发送和数据发送不在同一条带，前者带外，后者带外

TCP无状态，利用Cookies来处理 

FTP天然就是一个有状态的协议

命令及状态码的解释

![image-20250322085631046](/Users/jet/Library/Application Support/typora-user-images/image-20250322085631046.png)

FTP的控制命令和数据传输分别在两个TCP上进行



### 2.4 Email 

![image-20250322144940396](/Users/jet/Library/Application Support/typora-user-images/image-20250322144940396.png)

协议：

- 发送协议SMTP
- 拉取协议 Http POP3 IMP

HTTP可以上载文件和下载文件

电子邮件中的用户代理 foxmail outlook

Web应用的用户代理-浏览器 

![image-20250322145451032](/Users/jet/Library/Application Support/typora-user-images/image-20250322145451032.png)

用户代理-服务器-队列

发送 SMTP 拉取 POP3

前两跳推 后一跳拉 

![image-20250322145831553](/Users/jet/Library/Application Support/typora-user-images/image-20250322145831553.png)

ASCII码-可以直接解读出来 

规范文件内容必须在ASCII码的范围内

![image-20250322150046294](/Users/jet/Library/Application Support/typora-user-images/image-20250322150046294.png)

2，4 SMTP    6 POP3

使用队列来平滑发送速度 

![image-20250322150227625](/Users/jet/Library/Application Support/typora-user-images/image-20250322150227625.png)

全是客户端自己写的明文 

![image-20250322150536097](/Users/jet/Library/Application Support/typora-user-images/image-20250322150536097.png)

![image-20250322150550666](/Users/jet/Library/Application Support/typora-user-images/image-20250322150550666.png)

Tip：

- SMTP是持久连接
- 邮件内容需为ASCII码范围
- HTTP-拉
- SMTP-推

- HTTP响应报文至多一个对象 
- SMTP中一个文件可以有多个对象，eg：录音，图像等



![image-20250322150821542](/Users/jet/Library/Application Support/typora-user-images/image-20250322150821542.png)

cc-抄送  

![image-20250322150945441](/Users/jet/Library/Application Support/typora-user-images/image-20250322150945441.png)

如果文件内容不在ASCII码范围内，则需要进行扩展 eg-MIME 

常见：Base64编码， 把不在ASCII码范围内的字符转化为更长的在ASCII码范围内的字符

![image-20250322151213212](/Users/jet/Library/Application Support/typora-user-images/image-20250322151213212.png)

IMAP允许BOB在远程邮箱中创建目录 ， 可以远程搬运

![image-20250322151447494](/Users/jet/Library/Application Support/typora-user-images/image-20250322151447494.png)

用户认证

- 用户名
- 密码

通过打补丁来提供邮件系统的安全性

 retr 1 拉取邮件 

dele 1 在邮箱中把1号文件删除

上图为下载并删除方式  

下载并保留-邮件还能在客户端中 

![image-20250322151812752](/Users/jet/Library/Application Support/typora-user-images/image-20250322151812752.png)

POP3 不支持远程邮件维护 ， 只支持本地维护

IMAP 允许用户在远程组织文件目录



### 2.5 DNS

Everything over RIP

域名解析系统也是一个基础设施   

域名解析不是给人用的应用 

C/S P2P模式

CDN-内容访问加速 - 向Web应用提供加速应用

如何使用传输层向应用层提供的服务

![image-20250323092300956](/Users/jet/Library/Application Support/typora-user-images/image-20250323092300956.png)

域名解析系统 IP地址-数字型 ：域名到IP地址的转换

![image-20250323092547539](/Users/jet/Library/Application Support/typora-user-images/image-20250323092547539.png)

解决重名-分层化命名

哪些节点维护哪些域名 

Q：

- naming
- 解析
- 文字

![image-20250323093011477](/Users/jet/Library/Application Support/typora-user-images/image-20250323093011477.png)

名字越来越多，解析越来越麻烦

![image-20250323093056195](/Users/jet/Library/Application Support/typora-user-images/image-20250323093056195.png)

- 分层命名
- 分布式的数据库

DNS适合UDP 直接告诉名字即可

域名解析系统是在主机的应用层实现的

规范名字是为了管理，别名是为了用户的访问

key point：规范名字与别名之间怎么转换

邮件服务器的别名-邮件服务器的正规名字-域名解析系统查询

![image-20250323093823422](/Users/jet/Library/Application Support/typora-user-images/image-20250323093823422.png)

树-顶级域-二级域

名字空间按一层一层来划分

![image-20250323094237243](/Users/jet/Library/Application Support/typora-user-images/image-20250323094237243.png)

多个根域名服务器-增加可靠性

![image-20250323094422646](/Users/jet/Library/Application Support/typora-user-images/image-20250323094422646.png)

![image-20250323094726555](/Users/jet/Library/Application Support/typora-user-images/image-20250323094726555.png)

层次化命名-减少重名概率  解决标识问题

![image-20250324083500492](/Users/jet/Library/Application Support/typora-user-images/image-20250324083500492.png)

在同一个网络的主机可以属于不同的域

![image-20250324083639430](/Users/jet/Library/Application Support/typora-user-images/image-20250324083639430.png)

zone-名字服务器 

域的权威服务器 

![image-20250324084027122](/Users/jet/Library/Application Support/typora-user-images/image-20250324084027122.png)

![image-20250324084201506](/Users/jet/Library/Application Support/typora-user-images/image-20250324084201506.png)

需要知道域名服务器的物理位置和IP信息

![image-20250324084337568](/Users/jet/Library/Application Support/typora-user-images/image-20250324084337568.png)

区域服务器需要维护数据库 

不同字段值有不同的名字 

TTL-生存时间  可以是长期的也可以是短期的

- 无限值-权威信息
- 有限值-生存记录

缓冲是为了性能  删除是为了一致性（可能会变化）

![image-20250324085030996](/Users/jet/Library/Application Support/typora-user-images/image-20250324085030996.png)

别名对应的是正规名字

权威域名服务器的名称和IP地址

NS A 



![image-20250324085404860](/Users/jet/Library/Application Support/typora-user-images/image-20250324085404860.png)

 ![image-20250324085513445](/Users/jet/Library/Application Support/typora-user-images/image-20250324085513445.png)

解析器 协议 

上网

- IP地址
- 子网掩码
- DEfault getaway （往哪里走）
- 名字服务器local name server

![image-20250324085756761](/Users/jet/Library/Application Support/typora-user-images/image-20250324085756761.png)

![image-20250325083810532](/Users/jet/Library/Application Support/typora-user-images/image-20250325083810532.png)

又称为默认解析器

![image-20250325083928053](/Users/jet/Library/Application Support/typora-user-images/image-20250325083928053.png)

![image-20250325083947629](/Users/jet/Library/Application Support/typora-user-images/image-20250325083947629.png)

递归查询域名 一直问一直返回

![image-20250325084239737](/Users/jet/Library/Application Support/typora-user-images/image-20250325084239737.png)

根-顶级域-下级域名-

缓存-性能 删除-一致性

2![image-20250325084344984](/Users/jet/Library/Application Support/typora-user-images/image-20250325084344984.png) 

identification-标识号  flags-标识号

查询-结果 name-server

![image-20250325084522109](/Users/jet/Library/Application Support/typora-user-images/image-20250325084522109.png)

![image-20250325084535264](/Users/jet/Library/Application Support/typora-user-images/image-20250325084535264.png)

根据标识位来辨别是查询还是应答

![image-20250325084553044](/Users/jet/Library/Application Support/typora-user-images/image-20250325084553044.png)

![image-20250325084600971](/Users/jet/Library/Application Support/typora-user-images/image-20250325084600971.png)

子域服务器，名字服务器，指针 IP地址的对应关系

 维护-增加、删除、修改

![image-20250325084927885](/Users/jet/Library/Application Support/typora-user-images/image-20250325084927885.png)

local server-顶级域-二级域

把根服务器禁止后还是有办法可以查询到域名







### 2.6 P2P应用 





![image-20250325095046339](/Users/jet/Library/Application Support/typora-user-images/image-20250325095046339.png)

P2P任一节点既是服务器又是客户端

互联网语音电话走的是互联网 

![image-20250325095447917](/Users/jet/Library/Application Support/typora-user-images/image-20250325095447917.png)

上载下载是从用户的角度来说的

![image-20250325095754707](/Users/jet/Library/Application Support/typora-user-images/image-20250325095754707.png)

服务器上载 客户端下载

C/S 客户端上载，服务器下载

![image-20250325100310255](/Users/jet/Library/Application Support/typora-user-images/image-20250325100310255.png)

![image-20250325100332373](/Users/jet/Library/Application Support/typora-user-images/image-20250325100332373.png)

C/S的下载时间有下限 

分析情况：服务器跟客户端的能力谁强谁弱

![image-20250325100527444](/Users/jet/Library/Application Support/typora-user-images/image-20250325100527444.png)

![image-20250325100544251](/Users/jet/Library/Application Support/typora-user-images/image-20250325100544251.png)

服务器上载一份，客户端下载一份

Peer节点可以提供上行和下载的能力

![image-20250326083857155](/Users/jet/Library/Application Support/typora-user-images/image-20250326083857155.png)

P节点增加，请求服务也增加，提供服务的节点也在增加 

优点：

- 性能高
- 可扩展性好

网络具有高度动态性，网络难以管理

![image-20250326084124800](/Users/jet/Library/Application Support/typora-user-images/image-20250326084124800.png)



![image-20250326084225749](/Users/jet/Library/Application Support/typora-user-images/image-20250326084225749.png)

DHTC-分布式散列表

非结构化-节点之间有关系、有会话，节点之间可以构成环或树的关系

覆盖网-overlay  节点之间存在边的关系

DHTC-节点之间的边关系是无序的、随机的

运行客户端，搜索关键字，请求文件

![image-20250326084740638](/Users/jet/Library/Application Support/typora-user-images/image-20250326084740638.png)

![image-20250326084859943](/Users/jet/Library/Application Support/typora-user-images/image-20250326084859943.png)

P2P-节点管理问题-如何处理对等方

![image-20250326084927628](/Users/jet/Library/Application Support/typora-user-images/image-20250326084927628.png)

服务器上线时要向集中服务器发送通知

集中式服务器可以维护当前的IP列表

响应请求-反转文件  

目录-集中式 文件分发-P2P

![image-20250326085141561](/Users/jet/Library/Application Support/typora-user-images/image-20250326085141561.png)





![image-20250326085310961](/Users/jet/Library/Application Support/typora-user-images/image-20250326085310961.png)

边连接上下载的关系

完全分布式-没有中心服务器

实现也是开源的方式

泛洪查询-邻居查邻居

拥有资源给出应答

![image-20250326085553052](/Users/jet/Library/Application Support/typora-user-images/image-20250326085553052.png)

使用TTL来控制有限的泛洪

![image-20250326090223676](/Users/jet/Library/Application Support/typora-user-images/image-20250326090223676.png)

软件安装时有配置文件  

节点pin节点 节点ping了之后还要向中心节点发送pong

安装软件配置了死党列表

节点离开时再加入一个补充节点

![image-20250326090603602](/Users/jet/Library/Application Support/typora-user-images/image-20250326090603602.png)

混合体查询 

- 组员层面-混合式
- 组长层面-分布式

Hash值是文件的基本标识 

用户上载时匹配描述

![image-20250326090939152](/Users/jet/Library/Application Support/typora-user-images/image-20250326090939152.png)

索引-哈希，各值之间相互对应 

将哈希值作为唯一标记值来查询文件 

![image-20250327100747495](/Users/jet/Library/Application Support/typora-user-images/image-20250327100747495.png)

节点加入洪流 - 互通有无， 服务与被服务的关系

将报文分小组分小块  用01代表是否拥有该节点 用map来代表映射

所有节点在网络中泛洪bitmap-告诉节点们是否拥有信息

告诉节点们各个块的情况

显示bitmap是否为全0位图

![image-20250327101525824](/Users/jet/Library/Application Support/typora-user-images/image-20250327101525824.png)

稀缺优先 稀缺块-拉低下限  稀缺优先对集体有益

请求服务时先请求稀缺服务  稀缺块时间长 一开始有长时间无法提供和接受服务

拥有全部信息-种子 反之则是吸血鬼

向他人提供的信息较少时，自己请求服务可能会被排在较后面

![image-20250327102646938](/Users/jet/Library/Application Support/typora-user-images/image-20250327102646938.png)

每个周期都需要评估谁提供的带宽更大  

前两个周期在评估服务 第三个周期就是随便选一个节点 

![image-20250327103442477](/Users/jet/Library/Application Support/typora-user-images/image-20250327103442477.png)

稀缺优先的去请求块  第三个请求时是随机请求

![image-20250327103624209](/Users/jet/Library/Application Support/typora-user-images/image-20250327103624209.png)

文件上下载前要先做处理 

洪流文件 tracing server 跟踪服务器 来找Peer节点

点击列表 - 套用文件 - 请求server - 分配节点列表 - 处理互通有无

检索-下载套用文件（包括server） - 返回列表 - 处理互通

![image-20250327103924177](/Users/jet/Library/Application Support/typora-user-images/image-20250327103924177.png)

结构化的P2P维护的是树状、环状的有序拓扑

ID、环状大小首位构成环 

通过哈希来标记内容 



### 2.7 CDN  



![image-20250328175352236](/Users/jet/Library/Application Support/typora-user-images/image-20250328175352236.png)

视频浏览占据互联网的大部分带宽

并发优化服务

![image-20250328175552612](/Users/jet/Library/Application Support/typora-user-images/image-20250328175552612.png)

视频-一系列图像的序列 图像又是像素点的序列

视频带宽很大

时间和空间的冗余度 

可变编码，解析度动态变化

视频编码根据要求来变化

![image-20250328180114762](/Users/jet/Library/Application Support/typora-user-images/image-20250328180114762.png)

流媒体-下和看并行

流化播放-减少等待时间

![image-20250328180301083](/Users/jet/Library/Application Support/typora-user-images/image-20250328180301083.png)

不同解析度不同编码处理 

告示文件  不同码率

使用不同版本和不同块来发布，根据manifest文件来识别

具体向哪些服务器请求哪些块

保持持续流化播放

![image-20250328180803357](/Users/jet/Library/Application Support/typora-user-images/image-20250328180803357.png)

DASH-把一条视频切割成不同的块、不同的码率

![image-20250328180904970](/Users/jet/Library/Application Support/typora-user-images/image-20250328180904970.png)

服务器跳数多，智能优化自身 

瓶颈式链路会制约有效吞吐 

![image-20250328181707242](/Users/jet/Library/Application Support/typora-user-images/image-20250328181707242.png)

CDN-向流媒体服务提供商

互联网对象：

- 终端用户
- ISP
- CDN运营商
- ICP

ICP要购买CDN运营商的服务

CDN预先部署内容-内容加速服务

部署节点靠下

终端关键位置 

enter depp-深入群众

bring home-卡住中间节点

![image-20250328182402274](/Users/jet/Library/Application Support/typora-user-images/image-20250328182402274.png)

客户端决定怎么请求、向谁请求服务。

中国蓝汛-内容加速服务 

 key point：

让内容靠近用户

域名解析：域名到IP

CDN的开始节点运行在应用层，且是网络的边缘

网络层提供基本服务 

加速在应用层，everthing over the top 

![image-20250328183415166](/Users/jet/Library/Application Support/typora-user-images/image-20250328183415166.png)

key point：

- 节点部署
- 内容部署

![image-20250328183623756](/Users/jet/Library/Application Support/typora-user-images/image-20250328183623756.png)

authorative 权威域名服务器

链接、浏览器 

权威域名服务器-知道哪里需要服务

用户不知道是谁向他系统服务

![image-20250328184147798](/Users/jet/Library/Application Support/typora-user-images/image-20250328184147798.png)

登陆注册服务器 web服务在亚马逊的云服务器中

用户通过网飞服务器来认证 

由缓存节点提供dash服务



### 2.8 TCP套接字 

![image-20250329093641980](/Users/jet/Library/Application Support/typora-user-images/image-20250329093641980.png)

应用交换报文实现应用协议

报文通讯-借助下层的报文

应用层报文要借助服务

层间接口Socket，Socket API

![image-20250329094040101](/Users/jet/Library/Application Support/typora-user-images/image-20250329094040101.png)

![image-20250329094210364](/Users/jet/Library/Application Support/typora-user-images/image-20250329094210364.png)

TCP Socket发、收

![image-20250329094347786](/Users/jet/Library/Application Support/typora-user-images/image-20250329094347786.png)

创建Socket、  阻塞式-链接不成功就会堵在那里

创建-捆绑-等待 一套函数 

来一个Socket请求就返回一个Connection Socket

![image-20250329095404156](/Users/jet/Library/Application Support/typora-user-images/image-20250329095404156.png)

![image-20250329095504946](/Users/jet/Library/Application Support/typora-user-images/image-20250329095504946.png)

本地处理不做，叫做服务器处理

![image-20250329095549836](/Users/jet/Library/Application Support/typora-user-images/image-20250329095549836.png)

![image-20250329095646791](/Users/jet/Library/Application Support/typora-user-images/image-20250329095646791.png)

![image-20250329095836284](/Users/jet/Library/Application Support/typora-user-images/image-20250329095836284.png)

域名解析的函数调用 

输入域名得到IP地址 

服务器守护IP地址和端口号

![image-20250329151135889](/Users/jet/Library/Application Support/typora-user-images/image-20250329151135889.png)

创建Socket跟本地IP捆绑  

发出请求 响应应答 解除阻塞 

逐层传递，层间流动 

老进程一直守护在Welcome Socket  TCP Socket - 四元组本地代表 

表值来区分  

 ![image-20250331144833902](/Users/jet/Library/Application Support/typora-user-images/image-20250331144833902.png)

收和发谁先取决于应用层协议的定义

![image-20250331144912154](/Users/jet/Library/Application Support/typora-user-images/image-20250331144912154.png)

argv[0]是应用程序本身的名字

![image-20250331145021875](/Users/jet/Library/Application Support/typora-user-images/image-20250331145021875.png)

两个输入元素位于数组的不同位置中

不同元素发送时有大端小端的问题 高位低位的顺序问题

建、隐式访问、写、读

![image-20250331145638054](/Users/jet/Library/Application Support/typora-user-images/image-20250331145638054.png)

Sad是本地IP的端口号 

在服务时来了链接建立请求的话要把服务放在队列当中 

在服务过程中可能只有一个Welcome Socket，但有多个Connection Socket



### 2.9 UDP套接字编程 

UDP无握手 只和本地IP想捆绑

![image-20250401091758986](/Users/jet/Library/Application Support/typora-user-images/image-20250401091758986.png)

没有指明对方的IP和UDP端口 所以没有握手 

收报文

- 对方发送的内容-谁发给我
- 对方的端节点-发给谁

UDP不可靠、无连接

建立Socket，read Socket，bind Socket

Client Socket调用Socket函数

![image-20250401150554210](/Users/jet/Library/Application Support/typora-user-images/image-20250401150554210.png)

![image-20250401150559327](/Users/jet/Library/Application Support/typora-user-images/image-20250401150559327.png)

创建Socket，与本地IP捆绑  读read，最后关Socket 

服务器只有一个Socket ，没有welcome和Connection Socket之分 

![image-20250401150751015](/Users/jet/Library/Application Support/typora-user-images/image-20250401150751015.png)

参数

- 主机名字
- 主机端口号

域名解析 结构体 指针 

![image-20250401150933609](/Users/jet/Library/Application Support/typora-user-images/image-20250401150933609.png)

UDP

- 本地IP
- 发送给谁 

SAD-服务器端端节点 CAD-客户端端节点

![image-20250401151058622](/Users/jet/Library/Application Support/typora-user-images/image-20250401151058622.png)

循环-转换 接受 



### 2.10 小结 

![image-20250401151152479](/Users/jet/Library/Application Support/typora-user-images/image-20250401151152479.png)

TCP连接上传输-带内传输 
